<!DOCTYPE HTML>
<html>
<head>
  <title>SRPG</title>
  
  <style type="text/css">
    body { margin: 0; padding: 0; }
    #game {
      position: relative;
      border: 1px #000 solid;
    }
    #background{
      position: absolute;
      left: 0;
      top: 0;
      z-index: 0;
    }
    #sprites{
      position: relative;
      left: 0;
      top: 0;
      width: 960px;
      height: 640px;
      z-index: 0;
      border: 2px #8f8 dashed;
    }
    .character_sprite {
      position: absolute;
      width: 50px;
      height: 55px;
      border: 1px #299 solid;
    }
    .archer {
      background-image: url('images/sprite.png');
    }
  </style>
  
  <script type="text/javascript" src="js/vendor/prototype.js"></script>
  <script type="text/javascript" src="js/character.js"></script>
  <script type="text/javascript" src="js/renderer.js"></script>
  <script type="text/javascript" src="js/map.js"></script>
  <script type="text/javascript">
    window.onload = function(){
      var $ = document.getElementById;
      var cvs = document.getElementById('background');
      var c = document.getElementById('background').getContext("2d");
      var map_data = [
        [0,0,1,0,0],
        [0,1,1,1,0],
        [1,1,1,0,0],
        [1,1,1,0,0],
        [1,1,1,1,1]
      ];

      var archer = new Character;
      archer.x = 2;
      archer.y = 2;
      archer.sprite.name = 'sprite';
      
      var renderer = new Renderer();
      renderer.load_sprite(archer.sprite.name);
      renderer.load_sprite('ground');
      renderer.canvas = c;
      
      var map = new Map;
      map.data = map_data;
      
      renderer.map.object = map;
      
      var characters = [archer]
      var frames = 0;
      var frame_rate = 1000 / renderer.target_fps;
      var blit = function(){
        renderer.draw_background();
        renderer.draw_map();
        renderer.draw_characters(characters);
        frames++;
        document.getElementById('output').innerHTML = frames;
        
        characters[0].x = parseInt(Math.random() * 5);
        characters[0].y = parseInt(Math.random() * 5);
        
        //uncomment for unstoppable sprite flickering
        //setTimeout(blit,frame_rate);
      }
      blit();
      
    };
  </script>
</head>

<body>
  <div id="game">
    <canvas id="background" width="960" height="640"></canvas>
  </div>
  
  <div id="loader">
    <span id="output"></span>
  </div>
</body>

</html>